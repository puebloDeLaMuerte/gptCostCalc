<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cost Calculation and Plot</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div>
        <label for="steps">Number of Steps:</label>
        <input type="number" id="steps" value="20">
        <label for="inputCostFactor">Cost per Million Tokens (Input):</label>
        <input type="number" id="inputCostFactor" value="5">
        <label for="outputCostFactor">Cost per Million Tokens (Output):</label>
        <input type="number" id="outputCostFactor" value="15">
        <label for="avgTokensRequest">Average Tokens per Request:</label>
        <input type="number" id="avgTokensRequest" value="40">
        <label for="avgTokensReply">Average Tokens per Reply:</label>
        <input type="number" id="avgTokensReply" value="100">
        <button id="updateButton">Update Chart</button>
    </div>
    <canvas id="costChart" width="400" height="200"></canvas>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const ctx = document.getElementById('costChart').getContext('2d');
            let costChart;

            function calculateAndPlot() {
                const n = parseInt(document.getElementById('steps').value);
                const inputCostFactor = parseFloat(document.getElementById('inputCostFactor').value) / 1e6;
                const outputCostFactor = parseFloat(document.getElementById('outputCostFactor').value) / 1e6;
                const avgTokensRequest = parseFloat(document.getElementById('avgTokensRequest').value);
                const avgTokensReply = parseFloat(document.getElementById('avgTokensReply').value);

                const inputCosts = [];
                const outputCosts = [];
                const totalCosts = [];

                let accumulatedInput = 0;
                let accumulatedOutput = 0;

                for (let i = 1; i <= n; i++) {
                    const newQuery = avgTokensRequest;

                    accumulatedInput += newQuery + accumulatedOutput;
                    accumulatedOutput += avgTokensReply;

                    const inputCost = accumulatedInput * inputCostFactor;
                    const outputCost = accumulatedOutput * outputCostFactor;
                    const totalCost = inputCost + outputCost;

                    inputCosts.push(inputCost);
                    outputCosts.push(outputCost);
                    totalCosts.push(totalCost);
                }

                const data = {
                    labels: Array.from({ length: n }, (_, i) => i + 1),
                    datasets: [
                        {
                            label: 'Input Cost',
                            data: inputCosts,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: false,
                        },
                        {
                            label: 'Output Cost',
                            data: outputCosts,
                            borderColor: 'rgba(153, 102, 255, 1)',
                            backgroundColor: 'rgba(153, 102, 255, 0.2)',
                            fill: false,
                        },
                        {
                            label: 'Total Cost',
                            data: totalCosts,
                            borderColor: 'rgba(255, 159, 64, 1)',
                            backgroundColor: 'rgba(255, 159, 64, 0.2)',
                            fill: false,
                        }
                    ]
                };

                if (costChart) {
                    costChart.destroy();
                }

                costChart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        title: {
                            display: true,
                            text: 'Cost Calculation and Plot'
                        },
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true,
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Step'
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Cost (dollars)'
                                }
                            }
                        }
                    }
                });
            }

            document.getElementById('updateButton').addEventListener('click', calculateAndPlot);

            // Initial plot
            calculateAndPlot();
        });
    </script>
</body>
</html>